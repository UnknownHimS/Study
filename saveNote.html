<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sci-Fi Notes Editor</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');
  .media-wrapper {
  position: relative;
  display: inline-block;
  max-width: 100%;
  margin: 10px 0;
  border: 1px dashed #3f51b5;
  padding: 4px;
  border-radius: 6px;
  cursor: move;
  resize: both;
  overflow: auto;
}

.media-wrapper img,
.media-wrapper video {
  display: block;
  max-width: 100%;
  height: auto;
  border-radius: 4px;
}

.media-wrapper .delete-btn {
  position: absolute;
  top: 2px;
  right: 2px;
  background: #ff1744;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  padding: 2px 6px;
  cursor: pointer;
  z-index: 10;
}

  body {
    margin: 0;
    background: #0b0f19;
    color: #c7d0f7;
    font-family: 'Orbitron', sans-serif;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  /* Toolbar Buttons Container */
  #topButtons {
    position: fixed;
    top: 15px;
    left: 15px;
    display: flex;
    gap: 10px;
    z-index: 100;
  }
  /* Toolbar Button Styles */
  .toolbarBtn {
    background: linear-gradient(145deg, #1b1f34, #0e1224);
    border: 2px solid #3f51b5;
    border-radius: 6px;
    color: #a6b2ff;
    font-weight: 700;
    padding: 10px 20px;
    cursor: pointer;
    box-shadow: 0 0 10px #3f51b5;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
  }
  .toolbarBtn:hover {
    color: #fff;
    box-shadow: 0 0 20px #7986cb;
  }
  .toolbarBtn svg {
    fill: #7986cb;
    width: 20px;
    height: 20px;
  }

  /* Layout */
  #container {
    display: flex;
    width: 100%;
    height: 100vh;
  }

  /* Editor Section */
  #editorSection {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px;
    border-right: 2px solid #3f51b5;
    background: #12162b;
    overflow: hidden;
    transition: transform 0.3s ease;
    transform: translateX(100%);
    position: relative;
    z-index: 10;
  }
  #editorSection.active {
    transform: translateX(0);
  }

  /* Editor Toolbar */
  #editorToolbar {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  #editorToolbar button {
    background: #1e2447;
    border: none;
    color: #a6b2ff;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 0 8px #3f51b5;
    transition: background 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  #editorToolbar button:hover {
    background: #3f51b5;
    color: white;
  }
  #editorToolbar input[type="file"] {
    display: none;
  }

  /* Editable Content */
  #editor {
    flex: 1;
    background: #1a1f39;
    border-radius: 6px;
    padding: 15px;
    overflow-y: auto;
    outline: none;
    border: 1px solid #3f51b5;
    color: #c7d0f7;
  }

  #editor img, #editor video, #editor iframe {
    max-width: 100%;
    border-radius: 4px;
    margin: 5px 0;
  }
  /* PDF iframe styling */
  #editor iframe {
    height: 400px;
    border: none;
  }

  /* Storage Panel */
  #storagePanel {
    width: 320px;
    background: #0d1130;
    padding: 20px;
    overflow-y: auto;
    border-left: 2px solid #3f51b5;
    display: flex;
    flex-direction: column;
  }
  #storagePanel h2 {
    margin-top: 0;
    font-weight: 700;
    color: #7986cb;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1.5px;
  }
  #savedNotesList {
    margin-top: 15px;
    flex: 1;
    overflow-y: auto;
  }
  .noteItem {
    background: #1e2447;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    color: #a6b2ff;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    font-size: 0.85rem;
  }
  .noteItem:hover, .noteItem.active {
    background: #3f51b5;
    border-color: #7986cb;
    color: #fff;
  }

  /* Preview modal */
  #previewModal {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(11, 15, 25, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 1000;
  }
  #previewContent {
    background: #12162b;
    border-radius: 8px;
    max-width: 90vw;
    max-height: 90vh;
    overflow-y: auto;
    padding: 20px;
    color: #c7d0f7;
    position: relative;
  }
  #previewClose {
    background: #3f51b5;
    border: none;
    padding: 8px 16px;
    color: white;
    font-weight: 700;
    cursor: pointer;
    margin-bottom: 10px;
    border-radius: 6px;
    position: absolute;
    top: 10px;
    right: 10px;
  }
</style>
</head>
<body>

<!-- Top Toolbar Buttons -->
<div id="topButtons">
  <button id="openEditorBtn" class="toolbarBtn" title="Open Sci-Fi Editor" aria-label="Open Sci-Fi Editor">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M4 5h16v2H4V5zm0 6h16v2H4v-2zm0 6h16v2H4v-2z"/>
    </svg>
    Sci-Fi Notes
  </button>
  <a href="https://unknownhims.github.io/TaskList/" id="aboutBtn" class="toolbarBtn" title="Task List" aria-label="About link button" style="text-decoration:none;">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3.9 12a5 5 0 0 1 5-5h3v2H8.9a3 3 0 0 0 0 6h3v2h-3a5 5 0 0 1-5-5zm11.2-3h-3v2h3a3 3 0 0 1 0 6h-3v2h3a5 5 0 0 0 0-10z"/>
    </svg>
    Task List
  </a>
</div>

<div id="container">
  <!-- Editor -->
  <section id="editorSection" aria-label="Editor Section">
    <div id="editorToolbar" role="toolbar" aria-label="Editor toolbar">
      <button type="button" id="boldBtn" title="Bold (Ctrl+B)" aria-label="Bold"><b>B</b></button>
      <button type="button" id="italicBtn" title="Italic (Ctrl+I)" aria-label="Italic"><i>I</i></button>
      <button type="button" id="underlineBtn" title="Underline (Ctrl+U)" aria-label="Underline"><u>U</u></button>
      <button type="button" id="insertImageBtn" title="Insert Image (File)" aria-label="Insert Image from file">üñºÔ∏è</button>
      <input type="file" id="imageInput" accept="image/*" />
      <button type="button" id="insertVideoBtn" title="Insert Video (File)" aria-label="Insert Video from file">üé•</button>
      <input type="file" id="videoInput" accept="video/*" />
      <button type="button" id="insertImageUrlBtn" title="Insert Image via URL" aria-label="Insert Image via URL">üåêüñºÔ∏è</button>
      <button type="button" id="insertVideoUrlBtn" title="Insert Video via URL" aria-label="Insert Video via URL">üåêüé•</button>
      <button type="button" id="insertPdfUrlBtn" title="Insert PDF via URL" aria-label="Insert PDF via URL">üåêüìÑ</button>
      <button type="button" id="saveBtn" title="Save Note" aria-label="Save Note">üíæ Save</button>
      <button type="button" id="savePdfBtn" title="Save as PDF" aria-label="Save as PDF">üìÑ Save PDF</button>
      <button type="button" id="previewBtn" title="Preview Note" aria-label="Preview Note">üëÅÔ∏è Preview</button>
      <button type="button" id="closeEditorBtn" title="Close Editor" aria-label="Close Editor" style="margin-left:auto; background:#3f51b5;">‚úñÔ∏è Close</button>
    </div>
    <div id="editor" contenteditable="true" spellcheck="false" aria-label="Editable content area" tabindex="0">
      <p>Start writing your sci-fi notes here...</p>
    </div>
  </section>

  <!-- Storage Panel -->
  <aside id="storagePanel" aria-label="Saved notes storage panel">
    <h2>Storage Room</h2>
    <div id="savedNotesList" role="list" aria-live="polite" aria-relevant="additions removals"></div>
  </aside>
</div>

<!-- Preview Modal -->
<div id="previewModal" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
  <div id="previewContent">
    <button id="previewClose" aria-label="Close Preview">Close ‚úñÔ∏è</button>
    <div id="previewBody"></div>
  </div>
</div>

<!-- Libraries for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const {
    jsPDF
  } = window.jspdf;

  // Elements
  const openEditorBtn = document.getElementById('openEditorBtn');
  const aboutBtn = document.getElementById('aboutBtn');
  const editorSection = document.getElementById('editorSection');
  const editor = document.getElementById('editor');
  const savedNotesList = document.getElementById('savedNotesList');
  const saveBtn = document.getElementById('saveBtn');
  const previewBtn = document.getElementById('previewBtn');
  const closeEditorBtn = document.getElementById('closeEditorBtn');
  const previewModal = document.getElementById('previewModal');
  const previewClose = document.getElementById('previewClose');
  const previewBody = document.getElementById('previewBody');
  const savePdfBtn = document.getElementById('savePdfBtn');

  const insertImageBtn = document.getElementById('insertImageBtn');
  const insertVideoBtn = document.getElementById('insertVideoBtn');
  const insertImageUrlBtn = document.getElementById('insertImageUrlBtn');
  const insertVideoUrlBtn = document.getElementById('insertVideoUrlBtn');
  const insertPdfUrlBtn = document.getElementById('insertPdfUrlBtn');

  const imageInput = document.getElementById('imageInput');
  const videoInput = document.getElementById('videoInput');

  let currentNoteId = null;

  // Open editor
  openEditorBtn.addEventListener('click', () => {
    editorSection.classList.add('active');
    openEditorBtn.style.display = 'none';
    aboutBtn.style.display = 'none';
    if (!editor.innerHTML.trim()) {
      editor.innerHTML = '<p>Start writing your sci-fi notes here...</p>';
    }
  });

  // Close editor
  closeEditorBtn.addEventListener('click', () => {
    editorSection.classList.remove('active');
    openEditorBtn.style.display = 'flex';
    aboutBtn.style.display = 'flex';
    deselectAllNotes();
    currentNoteId = null;
    clearEditor();
  });

  // About button: replace link with your own URL here
  aboutBtn.addEventListener('click', () => {
    window.open('https://unknownhims.github.io/eyy/', '_blank', 'noopener');
   
  });

  // Format buttons
  document.getElementById('boldBtn').addEventListener('click', () => document.execCommand('bold'));
  document.getElementById('italicBtn').addEventListener('click', () => document.execCommand('italic'));
  document.getElementById('underlineBtn').addEventListener('click', () => document.execCommand('underline'));

  // Insert image file
  insertImageBtn.addEventListener('click', () => imageInput.click());
  imageInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = ev => insertImage(ev.target.result);
      reader.readAsDataURL(file);
    }
    imageInput.value = '';
  });
 function insertImage(src) {
  const wrapper = document.createElement('div');
  wrapper.className = 'media-wrapper';
  wrapper.contentEditable = false;

  const img = document.createElement('img');
  img.src = src;
  img.alt = "Inserted image";

  const delBtn = document.createElement('button');
  delBtn.className = 'delete-btn';
  delBtn.innerText = '√ó';
  delBtn.onclick = () => wrapper.remove();

  wrapper.appendChild(img);
  wrapper.appendChild(delBtn);
  insertNode(wrapper);
}

function insertVideo(src) {
  const wrapper = document.createElement('div');
  wrapper.className = 'media-wrapper';
  wrapper.contentEditable = false;

  const video = document.createElement('video');
  video.src = src;
  video.controls = true;
  video.style.width = "100%";

  const delBtn = document.createElement('button');
  delBtn.className = 'delete-btn';
  delBtn.innerText = '√ó';
  delBtn.onclick = () => wrapper.remove();

  wrapper.appendChild(video);
  wrapper.appendChild(delBtn);
  insertNode(wrapper);
}

  // Insert Image URL
  insertImageUrlBtn.addEventListener('click', () => {
    const url = prompt('Enter image URL:');
    if (url) insertImage(url);
  });

  // Insert Video URL
  insertVideoUrlBtn.addEventListener('click', () => {
    const url = prompt('Enter video URL (MP4/WebM):');
    if (url) insertVideo(url);
  });

  // Insert PDF URL (embedded iframe)
  insertPdfUrlBtn.addEventListener('click', () => {
    const url = prompt('Enter PDF URL:');
    if (url) insertAtCursor(`<iframe src="${url}" title="Embedded PDF"></iframe>`);
  });

  // Helper insert at cursor
  function insertAtCursor(html) {
    editor.focus();
    const sel = window.getSelection();
    if (!sel || !sel.rangeCount) {
      editor.innerHTML += html;
      return;
    }
    const range = sel.getRangeAt(0);
    range.deleteContents();

    const el = document.createElement('div');
    el.innerHTML = html;
    const frag = document.createDocumentFragment();
    let node, lastNode;
    while ((node = el.firstChild)) {
      lastNode = frag.appendChild(node);
    }
    range.insertNode(frag);

    // Move cursor after inserted content
    if (lastNode) {
      range.setStartAfter(lastNode);
      range.collapse(true);
      sel.removeAllRanges();
      sel.addRange(range);
    }
    editor.focus();
  }
  function insertNode(node) {
  editor.focus();
  const sel = window.getSelection();
  if (!sel || !sel.rangeCount) {
    editor.appendChild(node);
    return;
  }

  const range = sel.getRangeAt(0);
  range.deleteContents();
  range.insertNode(node);

  // Move cursor after the inserted node
  range.setStartAfter(node);
  range.collapse(true);
  sel.removeAllRanges();
  sel.addRange(range);
}


  // Save Note
  saveBtn.addEventListener('click', () => {
    const content = editor.innerHTML.trim();
    if (!content || content === '<p>Start writing your sci-fi notes here...</p>') {
      alert('Cannot save empty note.');
      return;
    }
    if (currentNoteId) {
      // Update existing
      localStorage.setItem(currentNoteId, content);
      alert('Note updated!');
    } else {
      // Save new
      const id = Date.now().toString();
      localStorage.setItem(id, content);
      currentNoteId = id;
      alert('Note saved!');
    }
    loadSavedNotes();
    highlightNote(currentNoteId);
  });

  // Load saved notes list
  function loadSavedNotes() {
    savedNotesList.innerHTML = '';
    // Sort keys by date desc
    const keys = Object.keys(localStorage).filter(k => !isNaN(k)).sort((a,b) => b - a);
    if (keys.length === 0) {
      savedNotesList.innerHTML = '<p style="color:#7986cb; text-align:center;">No saved notes yet.</p>';
      return;
    }
    keys.forEach(id => {
      const note = localStorage.getItem(id);
      const div = document.createElement('div');
      div.className = 'noteItem';
      div.tabIndex = 0;
      div.role = 'listitem';
      div.title = 'Click to load this note';
      div.innerHTML = summarizeContent(note);
      div.dataset.id = id;

      // Click loads note
      div.addEventListener('click', () => loadNote(id));
      div.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          loadNote(id);
        }
      });

      savedNotesList.appendChild(div);
    });
  }

  // Highlight loaded note
  function highlightNote(id) {
    const items = document.querySelectorAll('.noteItem');
    items.forEach(i => i.classList.toggle('active', i.dataset.id === id));
  }
  function deselectAllNotes() {
    const items = document.querySelectorAll('.noteItem');
    items.forEach(i => i.classList.remove('active'));
  }

  // Load note into editor
  function loadNote(id) {
    const content = localStorage.getItem(id);
    if (content) {
      editor.innerHTML = content;
      currentNoteId = id;
      highlightNote(id);
      editorSection.classList.add('active');
      openEditorBtn.style.display = 'none';
    }
  }

  // Clear editor content
  function clearEditor() {
    editor.innerHTML = '<p>Start writing your sci-fi notes here...</p>';
  }

  // Summarize note for display in list
  function summarizeContent(html) {
    const div = document.createElement('div');
    div.innerHTML = html;
    const text = div.textContent || div.innerText || '';
    if (text.length > 60) return text.slice(0, 57) + '...';
    if (text.length) return text;
    // fallback: show presence of media
    if (html.includes('<img')) return '[Image Note]';
    if (html.includes('<video')) return '[Video Note]';
    if (html.includes('<iframe')) return '[PDF Note]';
    return '[Empty Note]';
  }

  // Preview Note
  previewBtn.addEventListener('click', () => {
    previewBody.innerHTML = editor.innerHTML;
    previewModal.style.display = 'flex';
  });

  previewClose.addEventListener('click', () => {
    previewModal.style.display = 'none';
  });
  previewModal.addEventListener('click', e => {
    if (e.target === previewModal) {
      previewModal.style.display = 'none';
    }
  });

  // Keyboard shortcuts for formatting
  editor.addEventListener('keydown', e => {
    if (e.ctrlKey) {
      switch (e.key.toLowerCase()) {
        case 'b':
          e.preventDefault();
          document.execCommand('bold');
          break;
        case 'i':
          e.preventDefault();
          document.execCommand('italic');
          break;
        case 'u':
          e.preventDefault();
          document.execCommand('underline');
          break;
      }
    }
  });

  // Save as PDF button
  savePdfBtn.addEventListener('click', async () => {
    // Show loading alert (can be replaced with better UI)
    alert('Generating PDF, please wait...');

    // Use html2canvas to convert editor content to canvas
    const element = editor;

    // Temporarily scale for better resolution
    const scale = 2;
    const canvas = await html2canvas(element, {
      scale: scale,
      useCORS: true,
      logging: false,
      backgroundColor: '#12162b'
    });

    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF({
      orientation: 'portrait',
      unit: 'pt',
      format: [canvas.width * 72 / 96, canvas.height * 72 / 96] // convert px to pt approx (96dpi -> 72pt)
    });
    pdf.addImage(imgData, 'PNG', 0, 0, canvas.width * 72 / 96, canvas.height * 72 / 96);

    // Save with timestamp filename
    const filename = `SciFiNote_${new Date().toISOString().replace(/[:.]/g, '-')}.pdf`;
    pdf.save(filename);
  });

  // On page load
  loadSavedNotes();

</script>
</body>
</html>
